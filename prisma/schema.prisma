generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}


datasource db {
  provider = "postgresql"
  url = env("POSTGRES_PRISMA_URL") // uses connection pooling
  //directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model Watchlist {
  symbol String @id
  name String
}

model Trade {
  id        String     @default(cuid()) @id
  symbol String
  numberOfContracts Int
  transactionStartDate     DateTime  @db.Date
  transactionEndDate     DateTime?  @db.Date
  strikePrice Decimal
  contractPrice Decimal
  contractPriceAtClose Decimal?
  contractType String
  contractExpiry DateTime  @db.Date
  approxStockPriceAtPurchase Decimal?
  notes String?
  createdAt     DateTime  @default(now()) @map(name: "created_at")
  updatedAt     DateTime  @updatedAt @map(name: "updated_at")
  lastContractPrice Decimal?
  @@map(name: "trades")
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String
  status    MessageStatus @default(PENDING)
  adminNote String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MessageStatus {
  PENDING
  REVIEWED
  RESPONDED
  CLOSED
}

enum Broker {
  ROBINHOOD
  WEBULL
  FIDELITY
  THINKORSWIM
  INTERACTIVE_BROKERS
  TRADIER
  OTHER
}

model BrokerAccount {
  id            String     @default(cuid()) @id
  broker        String     // e.g., "Robinhood", "Webull", "Fidelity"
  accountName   String     // e.g., "RH - Cash", "Webull - Margin", "Fidelity IRA"
  accountNumber String?    // optional account number for reference
  createdAt     DateTime   @default(now()) @map(name: "created_at")
  updatedAt     DateTime   @updatedAt @map(name: "updated_at")
  
  portfolio     Portfolio[]
  
  @@unique([broker, accountName])  // Prevent duplicate account names per broker
  @@map(name: "broker_accounts")
}

model Portfolio {
  id               String     @default(cuid()) @id
  symbol           String
  quantity         Int
  brokerAccountId  String
  brokerAccount    BrokerAccount @relation(fields: [brokerAccountId], references: [id], onDelete: Cascade)
  costBasis        Decimal?   // Optional: cost per share
  notes            String?
  createdAt        DateTime   @default(now()) @map(name: "created_at")
  updatedAt        DateTime   @updatedAt @map(name: "updated_at")
  
  @@unique([symbol, brokerAccountId])  // Prevent duplicate positions in same account
  @@map(name: "portfolio")
}
